<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"101.133.132.187",root:"/",scheme:"Muse",version:"7.8.0",exturl:!1,sidebar:{position:"right",display:"remove",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!0,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="红外通信原理红外通信的整个工作过程发送过程数据 -&gt; 编码 -&gt; 调制 -&gt; 发送电路  数据：假设发送的数据为 0XA5，二进制为：10100101   编码：用脉冲宽度编码（Pulse Width Encoding）来表示二进制数据。每个数据位由一系列的脉冲组成，逻辑0和逻辑1分别由不同的脉冲宽度表示。现假设如下：   ​            逻辑0为：0.5ms高 + 0"><meta property="og:type" content="article"><meta property="og:title" content="嵌入式总结（一）"><meta property="og:url" content="http://101.133.132.187/archives/76bb4a41.html"><meta property="og:site_name" content="龙猫知识库"><meta property="og:description" content="红外通信原理红外通信的整个工作过程发送过程数据 -&gt; 编码 -&gt; 调制 -&gt; 发送电路  数据：假设发送的数据为 0XA5，二进制为：10100101   编码：用脉冲宽度编码（Pulse Width Encoding）来表示二进制数据。每个数据位由一系列的脉冲组成，逻辑0和逻辑1分别由不同的脉冲宽度表示。现假设如下：   ​            逻辑0为：0.5ms高 + 0"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2024-06-12T03:30:24.000Z"><meta property="article:modified_time" content="2024-08-08T03:11:15.793Z"><meta property="article:author" content="Totoro"><meta property="article:tag" content="嵌入式"><meta name="twitter:card" content="summary"><link rel="canonical" href="http://101.133.132.187/archives/76bb4a41.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>嵌入式总结（一） | 龙猫知识库</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">龙猫知识库</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://101.133.132.187/archives/76bb4a41.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Totoro"><meta itemprop="description" content="学而时习之，不亦说乎"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="龙猫知识库"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">嵌入式总结（一）</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2024-06-12 11:30:24" itemprop="dateCreated datePublished" datetime="2024-06-12T11:30:24+08:00">2024-06-12</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-08-08 11:11:15" itemprop="dateModified" datetime="2024-08-08T11:11:15+08:00">2024-08-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">嵌入式</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="红外通信原理"><a href="#红外通信原理" class="headerlink" title="红外通信原理"></a>红外通信原理</h2><h3 id="红外通信的整个工作过程"><a href="#红外通信的整个工作过程" class="headerlink" title="红外通信的整个工作过程"></a>红外通信的整个工作过程</h3><h4 id="发送过程"><a href="#发送过程" class="headerlink" title="发送过程"></a>发送过程</h4><p><strong>数据 -&gt; 编码 -&gt; 调制 -&gt; 发送电路</strong></p><ol><li><p>数据：假设发送的数据为 0XA5，二进制为：10100101</p></li><li><p>编码：用脉冲宽度编码（Pulse Width Encoding）来表示二进制数据。每个数据位由一系列的脉冲组成，逻辑0和逻辑1分别由不同的脉冲宽度表示。现假设如下：</p></li></ol><p>​ <strong>逻辑0为：0.5ms高 + 0.5ms低；</strong> <strong>逻辑1为：1ms高 + 0.5ms低；</strong></p><ol start="3"><li>调制：就是把编码数据放到一定频率的载波上面，即使用数据调制载波，形成一串脉冲信号</li><li>发送电路：即：红外灯珠对脉冲信号的发送 + 脉冲信号的放大</li></ol><span id="more"></span><h4 id="接收过程"><a href="#接收过程" class="headerlink" title="接收过程"></a>接收过程</h4><p><strong>接收电路 -&gt; 解调 -&gt; 解码 -&gt; 数据</strong></p><ol><li>接收电路：接收发过来的红外信号</li><li>解调：当红外接收管接收到调制信号时，输出高电平，否则输出为低电平</li><li>解码：解调后将得到的一系列脉冲变为二进制</li><li>数据：解码后即可得到发来的数据，即 0XA5 （二进制为：10100101）</li></ol><h4 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h4><p><strong>红外通信的优点：抗电磁干扰、成本低</strong></p><p><strong>红外通信的缺点：传输效率低，易受到环境光干扰导致传输误码</strong></p><h2 id="ADC数据常用的处理"><a href="#ADC数据常用的处理" class="headerlink" title="ADC数据常用的处理"></a>ADC数据常用的处理</h2><p>为什么要对采样的数据进行处理呢？直接拿来用不行吗？<br>因为任何系统都会存在干扰，进行数据处理就是为了尽量避免因外界干扰引起的误差。</p><h4 id="常用的两种滤波方法"><a href="#常用的两种滤波方法" class="headerlink" title="常用的两种滤波方法"></a>常用的两种滤波方法</h4><ol><li>多次采样加权取平均，在写程序的时候可以运用一些技巧：首先我们ADC采集8次数据并且对这8次数据累加（可以每1ms调用该函数），累加完成后将累加结果右移3位得到最后的采样结果。<br>当然这个方法还可以进一步改善，比如取样10次，然后去掉最大值和最小值，再对剩下的8次进行取平均。</li></ol><p><strong>但因为需要多次采样，更新数据的时间会很长，比如取样8次，每1ms取样一次，那么更新数据就需要8ms时间，所以对采样的数据实时性要求不是很高的系统才可以用这种方法</strong></p><ol start="2"><li>中值滤波法（可用在实时性比较高的系统）：实现思想就是取5个数据，每次采样的新数据替换掉最老的数据；然后把中间的那个数据当做是采样数据，这样不仅可以有效抑制干扰，而且响应速度快。</li></ol><h4 id="十大滤波方法及代码实现"><a href="#十大滤波方法及代码实现" class="headerlink" title="十大滤波方法及代码实现"></a>十大滤波方法及代码实现</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;windows.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> ftable[<span class="number">255</span>] = &#123;</span><br><span class="line">    <span class="number">2048</span>, <span class="number">2098</span>, <span class="number">2148</span>, <span class="number">2198</span>, <span class="number">2248</span>, <span class="number">2298</span>, <span class="number">2348</span>, <span class="number">2398</span>, <span class="number">2447</span>, <span class="number">2496</span>,</span><br><span class="line">    <span class="number">2545</span>, <span class="number">2594</span>, <span class="number">2642</span>, <span class="number">2690</span>, <span class="number">2737</span>, <span class="number">2785</span>, <span class="number">2831</span>, <span class="number">2877</span>, <span class="number">2923</span>, <span class="number">2968</span>,</span><br><span class="line">    <span class="number">3013</span>, <span class="number">3057</span>, <span class="number">3100</span>, <span class="number">3143</span>, <span class="number">3185</span>, <span class="number">3227</span>, <span class="number">3267</span>, <span class="number">3307</span>, <span class="number">3347</span>, <span class="number">3385</span>,</span><br><span class="line">    <span class="number">3423</span>, <span class="number">3460</span>, <span class="number">3496</span>, <span class="number">3531</span>, <span class="number">3565</span>, <span class="number">3598</span>, <span class="number">3631</span>, <span class="number">3662</span>, <span class="number">3692</span>, <span class="number">3722</span>,</span><br><span class="line">    <span class="number">3750</span>, <span class="number">3778</span>, <span class="number">3804</span>, <span class="number">3829</span>, <span class="number">3854</span>, <span class="number">3877</span>, <span class="number">3899</span>, <span class="number">3920</span>, <span class="number">3940</span>, <span class="number">3958</span>,</span><br><span class="line">    <span class="number">3976</span>, <span class="number">3992</span>, <span class="number">4007</span>, <span class="number">4021</span>, <span class="number">4034</span>, <span class="number">4046</span>, <span class="number">4056</span>, <span class="number">4065</span>, <span class="number">4073</span>, <span class="number">4080</span>,</span><br><span class="line">    <span class="number">4086</span>, <span class="number">4090</span>, <span class="number">4093</span>, <span class="number">4095</span>, <span class="number">4095</span>, <span class="number">4095</span>, <span class="number">4093</span>, <span class="number">4090</span>, <span class="number">4086</span>, <span class="number">4080</span>,</span><br><span class="line">    <span class="number">4073</span>, <span class="number">4065</span>, <span class="number">4056</span>, <span class="number">4046</span>, <span class="number">4034</span>, <span class="number">4021</span>, <span class="number">4007</span>, <span class="number">3992</span>, <span class="number">3976</span>, <span class="number">3958</span>,</span><br><span class="line">    <span class="number">3940</span>, <span class="number">3920</span>, <span class="number">3899</span>, <span class="number">3877</span>, <span class="number">3854</span>, <span class="number">3829</span>, <span class="number">3804</span>, <span class="number">3778</span>, <span class="number">3750</span>, <span class="number">3722</span>,</span><br><span class="line">    <span class="number">3692</span>, <span class="number">3662</span>, <span class="number">3631</span>, <span class="number">3598</span>, <span class="number">3565</span>, <span class="number">3531</span>, <span class="number">3496</span>, <span class="number">3460</span>, <span class="number">3423</span>, <span class="number">3385</span>,</span><br><span class="line">    <span class="number">3347</span>, <span class="number">3307</span>, <span class="number">3267</span>, <span class="number">3227</span>, <span class="number">3185</span>, <span class="number">3143</span>, <span class="number">3100</span>, <span class="number">3057</span>, <span class="number">3013</span>, <span class="number">2968</span>,</span><br><span class="line">    <span class="number">2923</span>, <span class="number">2877</span>, <span class="number">2831</span>, <span class="number">2785</span>, <span class="number">2737</span>, <span class="number">2690</span>, <span class="number">2642</span>, <span class="number">2594</span>, <span class="number">2545</span>, <span class="number">2496</span>,</span><br><span class="line">    <span class="number">2447</span>, <span class="number">2398</span>, <span class="number">2348</span>, <span class="number">2298</span>, <span class="number">2248</span>, <span class="number">2198</span>, <span class="number">2148</span>, <span class="number">2098</span>, <span class="number">2047</span>, <span class="number">1997</span>,</span><br><span class="line">    <span class="number">1947</span>, <span class="number">1897</span>, <span class="number">1847</span>, <span class="number">1797</span>, <span class="number">1747</span>, <span class="number">1697</span>, <span class="number">1648</span>, <span class="number">1599</span>, <span class="number">1550</span>, <span class="number">1501</span>,</span><br><span class="line">    <span class="number">1453</span>, <span class="number">1405</span>, <span class="number">1358</span>, <span class="number">1310</span>, <span class="number">1264</span>, <span class="number">1218</span>, <span class="number">1172</span>, <span class="number">1127</span>, <span class="number">1082</span>, <span class="number">1038</span>,</span><br><span class="line">    <span class="number">995</span>, <span class="number">952</span>, <span class="number">910</span>, <span class="number">868</span>, <span class="number">828</span>, <span class="number">788</span>, <span class="number">748</span>, <span class="number">710</span>, <span class="number">672</span>, <span class="number">635</span>,</span><br><span class="line">    <span class="number">599</span>, <span class="number">564</span>, <span class="number">530</span>, <span class="number">497</span>, <span class="number">464</span>, <span class="number">433</span>, <span class="number">403</span>, <span class="number">373</span>, <span class="number">345</span>, <span class="number">317</span>,</span><br><span class="line">    <span class="number">291</span>, <span class="number">266</span>, <span class="number">241</span>, <span class="number">218</span>, <span class="number">196</span>, <span class="number">175</span>, <span class="number">155</span>, <span class="number">137</span>, <span class="number">119</span>, <span class="number">103</span>,</span><br><span class="line">    <span class="number">88</span>, <span class="number">74</span>, <span class="number">61</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">5</span>,</span><br><span class="line">    <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">15</span>, <span class="number">22</span>, <span class="number">30</span>,</span><br><span class="line">    <span class="number">39</span>, <span class="number">49</span>, <span class="number">61</span>, <span class="number">74</span>, <span class="number">88</span>, <span class="number">103</span>, <span class="number">119</span>, <span class="number">137</span>, <span class="number">155</span>, <span class="number">175</span>,</span><br><span class="line">    <span class="number">196</span>, <span class="number">218</span>, <span class="number">241</span>, <span class="number">266</span>, <span class="number">291</span>, <span class="number">317</span>, <span class="number">345</span>, <span class="number">373</span>, <span class="number">403</span>, <span class="number">433</span>,</span><br><span class="line">    <span class="number">464</span>, <span class="number">497</span>, <span class="number">530</span>, <span class="number">564</span>, <span class="number">599</span>, <span class="number">635</span>, <span class="number">672</span>, <span class="number">710</span>, <span class="number">748</span>, <span class="number">788</span>,</span><br><span class="line">    <span class="number">828</span>, <span class="number">868</span>, <span class="number">910</span>, <span class="number">952</span>, <span class="number">995</span>, <span class="number">1038</span>, <span class="number">1082</span>, <span class="number">1127</span>, <span class="number">1172</span>, <span class="number">1218</span>,</span><br><span class="line">    <span class="number">1264</span>, <span class="number">1310</span>, <span class="number">1358</span>, <span class="number">1405</span>, <span class="number">1453</span>, <span class="number">1501</span>, <span class="number">1550</span>, <span class="number">1599</span>, <span class="number">1648</span>, <span class="number">1697</span>,</span><br><span class="line">    <span class="number">1747</span>, <span class="number">1797</span>, <span class="number">1847</span>, <span class="number">1897</span>, <span class="number">1947</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> b = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************************************</span></span><br><span class="line"><span class="comment">方法一：限幅滤波法</span></span><br><span class="line"><span class="comment">方法：根据经验判断，确定两次采样允许的最大偏差值（设为A），每次检测到新值时判断：</span></span><br><span class="line"><span class="comment">      如果本次值与上次值之差&lt;=A，则本次值有效，</span></span><br><span class="line"><span class="comment">      如果本次值与上次值之差&gt;A，则本次值无效，放弃本次值，用上次值代替本次值。</span></span><br><span class="line"><span class="comment">优点：能克服偶然因素引起的脉冲干扰</span></span><br><span class="line"><span class="comment">缺点：无法抑制周期性的干扰，平滑度差</span></span><br><span class="line"><span class="comment">******************************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define A 51</span></span><br><span class="line"><span class="comment">// unsigned short Value1 = 0;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// short filter1()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     static unsigned short NewValue = 0;</span></span><br><span class="line"><span class="comment">//     Value1                         = ftable[b - 1];</span></span><br><span class="line"><span class="comment">//     NewValue                       = ftable[b];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     a++;</span></span><br><span class="line"><span class="comment">//     if (a == 254)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         a = 0;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     b++;</span></span><br><span class="line"><span class="comment">//     if (b == 255)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         b = 1;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     if (((NewValue - Value1) &gt; A) || ((Value1 - NewValue) &gt; A))</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         printf(&quot;------\n&quot;);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     else</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         printf(&quot;%d, %d, %d\n&quot;, NewValue - Value1, NewValue, Value1);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************************************</span></span><br><span class="line"><span class="comment">方法二：中位值滤波法</span></span><br><span class="line"><span class="comment">方法： 连续采样N次（N取奇数），把N次采样值按大小排列，取中间值为本次有效值。</span></span><br><span class="line"><span class="comment">优点：克服偶然因素（对温度、液位的变化缓慢的被测参数有良好的滤波效果）</span></span><br><span class="line"><span class="comment">缺点：对流量、速度等快速变化的参数不宜</span></span><br><span class="line"><span class="comment">******************************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define N 3</span></span><br><span class="line"><span class="comment">// unsigned short value_buf[N];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// short filter2()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     unsigned short count, i, j, temp;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     // 将采集的ADC值分别存入数组中，且后边存的值覆盖前边存的值</span></span><br><span class="line"><span class="comment">//     for (count = 0; count &lt; N; count++)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         value_buf[count] = ftable[a];</span></span><br><span class="line"><span class="comment">//         a++;</span></span><br><span class="line"><span class="comment">//         if (a == 254)</span></span><br><span class="line"><span class="comment">//         &#123;</span></span><br><span class="line"><span class="comment">//             a = 0;</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     // 冒泡排序 - 从小到大排</span></span><br><span class="line"><span class="comment">//     for (j = 0; j &lt; N - 1; j++)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         for (i = 0; i &lt; N - 1 - j; i++)</span></span><br><span class="line"><span class="comment">//         &#123;</span></span><br><span class="line"><span class="comment">//             if (value_buf[i] &gt; value_buf[i + 1])</span></span><br><span class="line"><span class="comment">//             &#123;</span></span><br><span class="line"><span class="comment">//                 temp             = value_buf[i];</span></span><br><span class="line"><span class="comment">//                 value_buf[i]     = value_buf[i + 1];</span></span><br><span class="line"><span class="comment">//                 value_buf[i + 1] = temp;</span></span><br><span class="line"><span class="comment">//             &#125;</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     // 选出中位数</span></span><br><span class="line"><span class="comment">//     printf(&quot;%d\n&quot;, value_buf[(N - 1) / 2]);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************************************</span></span><br><span class="line"><span class="comment">方法三：算术平均滤波法</span></span><br><span class="line"><span class="comment">方法：连续取N个采样值进行算术平均运算：（ N值的选取：一般流量，N=12；压力：N=4。）</span></span><br><span class="line"><span class="comment">      N值较大时：信号平滑度较高，但灵敏度较低；</span></span><br><span class="line"><span class="comment">      N值较小时：信号平滑度较低，但灵敏度较高；</span></span><br><span class="line"><span class="comment">优点：适用于对一般具有随机干扰的信号进行滤波；这种信号的特点是有一个平均值，信号在某一数值范围附近上下波动</span></span><br><span class="line"><span class="comment">缺点：对于测量速度较慢或要求数据计算速度较快的实时控制不适用，比较浪费RAM。</span></span><br><span class="line"><span class="comment">******************************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define N 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// short filter3()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     unsigned short sum = 0, count;</span></span><br><span class="line"><span class="comment">//     for (count = 0; count &lt; N; count++)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         sum += ftable[a];</span></span><br><span class="line"><span class="comment">//         a++;</span></span><br><span class="line"><span class="comment">//         if (a == 254)</span></span><br><span class="line"><span class="comment">//         &#123;</span></span><br><span class="line"><span class="comment">//             a = 0;</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     printf(&quot;%d\n&quot;, sum / N);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************************************</span></span><br><span class="line"><span class="comment">方法四：递推平均滤波法（又称滑动平均滤波法）</span></span><br><span class="line"><span class="comment">方法： 把连续取得的N个采样值看成一个队列，队列的长度固定为N，</span></span><br><span class="line"><span class="comment">       每次采样到一个新数据放入队尾，并扔掉原来队首的一次数据（先进先出原则），</span></span><br><span class="line"><span class="comment">       把队列中的N个数据进行算术平均运算，获得新的滤波结果。</span></span><br><span class="line"><span class="comment">       N值的选取：流量，N=12；压力，N=4；液面，N=4-12；温度，N=1-4。</span></span><br><span class="line"><span class="comment">优点：对周期性干扰有良好的抑制作用，平滑度高；</span></span><br><span class="line"><span class="comment">      适用于高频振荡的系统。</span></span><br><span class="line"><span class="comment">缺点：灵敏度低，对偶然出现的脉冲性干扰的抑制作用较差；</span></span><br><span class="line"><span class="comment">      不易消除由于脉冲干扰所引起的采样值偏差；</span></span><br><span class="line"><span class="comment">      不适用于脉冲干扰比较严重的场合；</span></span><br><span class="line"><span class="comment">      比较浪费RAM。</span></span><br><span class="line"><span class="comment">******************************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define FILTER4_N 3</span></span><br><span class="line"><span class="comment">// unsigned short filter_buf[FILTER4_N + 1]; // 滑动窗口大小 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// short filter4()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     static unsigned int j = 0;</span></span><br><span class="line"><span class="comment">//     int                 i = 0, filter_sum = 0;</span></span><br><span class="line"><span class="comment">//     filter_buf[FILTER4_N] = ftable[a]; // 将采集得到的数据依次存放到窗口数组最后</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     a++;</span></span><br><span class="line"><span class="comment">//     if (a == 254)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         a = 0;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     for (i = 0; i &lt; FILTER4_N; i++)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         // i = 0 1 2</span></span><br><span class="line"><span class="comment">//         j++;</span></span><br><span class="line"><span class="comment">//         filter_buf[i] = filter_buf[i + 1]; // 将窗口数组元素左移，即舍弃窗口数组的0元素</span></span><br><span class="line"><span class="comment">//         filter_sum += filter_buf[i];       // 累加窗口数组前三个元素</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     // 两轮过后才出现正确的均值，一轮3次，两轮6次；故 &gt; 6</span></span><br><span class="line"><span class="comment">//     if (j &gt; 6)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         printf(&quot;%d\n&quot;, filter_sum / FILTER4_N); // 窗口的前三个元素求平均</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************************************</span></span><br><span class="line"><span class="comment">方法五：中位值平均滤波法（又称防脉冲干扰平均滤波法）</span></span><br><span class="line"><span class="comment">方法： 采一组队列去掉最大值和最小值后取平均值，     （N值的选取：3-14）。</span></span><br><span class="line"><span class="comment">      相当于“中位值滤波法”+“算术平均滤波法”。</span></span><br><span class="line"><span class="comment">      连续采样N个数据，去掉一个最大值和一个最小值，</span></span><br><span class="line"><span class="comment">      然后计算N-2个数据的算术平均值。</span></span><br><span class="line"><span class="comment">优点： 融合了“中位值滤波法”+“算术平均滤波法”两种滤波法的优点。</span></span><br><span class="line"><span class="comment">       对于偶然出现的脉冲性干扰，可消除由其所引起的采样值偏差。</span></span><br><span class="line"><span class="comment">       对周期干扰有良好的抑制作用。</span></span><br><span class="line"><span class="comment">       平滑度高，适于高频振荡的系统。</span></span><br><span class="line"><span class="comment">缺点：对于测量速度较慢或要求数据计算速度较快的实时控制不适用，比较浪费RAM。</span></span><br><span class="line"><span class="comment">******************************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define N 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// int filter5()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     int i, j;</span></span><br><span class="line"><span class="comment">//     int filter_temp, filter_sum = 0;</span></span><br><span class="line"><span class="comment">//     int filter_buf[N];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     for (i = 0; i &lt; N; i++)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         // i = 0 1 2</span></span><br><span class="line"><span class="comment">//         filter_buf[i] = ftable[a];</span></span><br><span class="line"><span class="comment">//         a++;</span></span><br><span class="line"><span class="comment">//         if (a == 254)</span></span><br><span class="line"><span class="comment">//         &#123;</span></span><br><span class="line"><span class="comment">//             a = 0;</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     // 冒泡排序 - 从小到大排</span></span><br><span class="line"><span class="comment">//     for (j = 0; j &lt; N - 1; j++)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         for (i = 0; i &lt; N - 1 - j; i++)</span></span><br><span class="line"><span class="comment">//         &#123;</span></span><br><span class="line"><span class="comment">//             if (filter_buf[i] &gt; filter_buf[i + 1])</span></span><br><span class="line"><span class="comment">//             &#123;</span></span><br><span class="line"><span class="comment">//                 filter_temp       = filter_buf[i];</span></span><br><span class="line"><span class="comment">//                 filter_buf[i]     = filter_buf[i + 1];</span></span><br><span class="line"><span class="comment">//                 filter_buf[i + 1] = filter_temp;</span></span><br><span class="line"><span class="comment">//             &#125;</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     // 去除最大最小极值后求平均 - filter_buf[0]为最小值，filter_buf[N]为最大值</span></span><br><span class="line"><span class="comment">//     for (i = 1; i &lt; N - 1; i++)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         // i = 1</span></span><br><span class="line"><span class="comment">//         filter_sum += filter_buf[i];</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     printf(&quot;%d\n&quot;, filter_sum / (N - 2));</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************************************</span></span><br><span class="line"><span class="comment">方法六：限幅平均滤波法</span></span><br><span class="line"><span class="comment">方法： 相当于“限幅滤波法”+“递推平均滤波法”；</span></span><br><span class="line"><span class="comment">       每次采样到的新数据先进行限幅处理，</span></span><br><span class="line"><span class="comment">       再送入队列进行递推平均滤波处理。</span></span><br><span class="line"><span class="comment">优点： 融合了两种滤波法的优点；</span></span><br><span class="line"><span class="comment">      对于偶然出现的脉冲性干扰，可消除由于脉冲干扰所引起的采样值偏差。</span></span><br><span class="line"><span class="comment">缺点：比较浪费RAM。</span></span><br><span class="line"><span class="comment">******************************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define FILTER6_N 3</span></span><br><span class="line"><span class="comment">// #define FILTER6_A 51</span></span><br><span class="line"><span class="comment">// int filter_buf[FILTER6_N];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// int filter6()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     int i;</span></span><br><span class="line"><span class="comment">//     int filter_sum            = 0;</span></span><br><span class="line"><span class="comment">//     filter_buf[FILTER6_N - 1] = ftable[a]; // 将采样值依次存到数组最后一个元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     a++;</span></span><br><span class="line"><span class="comment">//     if (a == 254)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         a = 0;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     if (a &lt; 3)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         filter_buf[FILTER6_N - 3] = ftable[0];</span></span><br><span class="line"><span class="comment">//         filter_buf[FILTER6_N - 2] = ftable[1];</span></span><br><span class="line"><span class="comment">//         filter_buf[FILTER6_N - 1] = ftable[2];</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     else</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         // 若 filter_buf数组 中后两个元素之差大于 FILTER6_A</span></span><br><span class="line"><span class="comment">//         if (((filter_buf[FILTER6_N - 1] - filter_buf[FILTER6_N - 2]) &gt; FILTER6_A) || ((filter_buf[FILTER6_N - 2] - filter_buf[FILTER6_N - 1]) &gt; FILTER6_A))</span></span><br><span class="line"><span class="comment">//         &#123;</span></span><br><span class="line"><span class="comment">//             // 将倒数第二个元素覆盖最后一个元素 - 若超出规定幅值，则舍弃本次采集的值，并使用上次的ADC值代替</span></span><br><span class="line"><span class="comment">//             filter_buf[FILTER6_N - 1] = filter_buf[FILTER6_N - 2];</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//         for (i = 0; i &lt; FILTER6_N - 1; i++)</span></span><br><span class="line"><span class="comment">//         &#123;</span></span><br><span class="line"><span class="comment">//             // i = 0 1</span></span><br><span class="line"><span class="comment">//             filter_buf[i] = filter_buf[i + 1]; // 数组元素左移</span></span><br><span class="line"><span class="comment">//             filter_sum += filter_buf[i];</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//         printf(&quot;%d\n&quot;, filter_sum / (FILTER6_N - 1));</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************************************</span></span><br><span class="line"><span class="comment">方法七：一阶滞后滤波法</span></span><br><span class="line"><span class="comment">方法： 取a=0-1，本次滤波结果=(1-a)*本次采样值+a*上次滤波结果。</span></span><br><span class="line"><span class="comment">优点：  对周期性干扰具有良好的抑制作用；</span></span><br><span class="line"><span class="comment">        适用于波动频率较高的场合。</span></span><br><span class="line"><span class="comment">       平滑度高，适于高频振荡的系统。</span></span><br><span class="line"><span class="comment">缺点： 相位滞后，灵敏度低；</span></span><br><span class="line"><span class="comment">      滞后程度取决于a值大小；</span></span><br><span class="line"><span class="comment">      不能消除滤波频率高于采样频率1/2的干扰信号。</span></span><br><span class="line"><span class="comment">******************************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define FILTER7_A 0.01</span></span><br><span class="line"><span class="comment">// unsigned short Value;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// short filter7()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     int NewValue;</span></span><br><span class="line"><span class="comment">//     Value    = ftable[b - 1];</span></span><br><span class="line"><span class="comment">//     NewValue = ftable[b];</span></span><br><span class="line"><span class="comment">//     b++;</span></span><br><span class="line"><span class="comment">//     if (b == 255)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         b = 1;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     Value = (int)((float)NewValue * FILTER7_A + (1.0 - FILTER7_A) * (float)Value);</span></span><br><span class="line"><span class="comment">//     printf(&quot;%d\n&quot;, Value);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************************************</span></span><br><span class="line"><span class="comment">方法八：加权递推平均滤波法</span></span><br><span class="line"><span class="comment">方法： 是对递推平均滤波法的改进，即不同时刻的数据加以不同的权；</span></span><br><span class="line"><span class="comment">       通常是，越接近现时刻的数据，权取得越大。</span></span><br><span class="line"><span class="comment">       给予新采样值的权系数越大，则灵敏度越高，但信号平滑度越低。</span></span><br><span class="line"><span class="comment">优点： 适用于有较大纯滞后时间常数的对象，和采样周期较短的系统。</span></span><br><span class="line"><span class="comment">缺点：  对于纯滞后时间常数较小、采样周期较长、变化缓慢的信号；</span></span><br><span class="line"><span class="comment">       不能迅速反应系统当前所受干扰的严重程度，滤波效果差。</span></span><br><span class="line"><span class="comment">******************************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define FILTER8_N 12</span></span><br><span class="line"><span class="comment">// int coe[FILTER8_N] = &#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12&#125;;          // 加权系数表</span></span><br><span class="line"><span class="comment">// int sum_coe        = 1 + 2 + 3 + 4 + 5 + 6 + 7 + 8 + 9 + 10 + 11 + 12; // 加权系数和</span></span><br><span class="line"><span class="comment">// int filter_buf[FILTER8_N + 1];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// int filter8()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     int i;</span></span><br><span class="line"><span class="comment">//     int filter_sum        = 0;</span></span><br><span class="line"><span class="comment">//     filter_buf[FILTER8_N] = ftable[a];</span></span><br><span class="line"><span class="comment">//     a++;</span></span><br><span class="line"><span class="comment">//     if (a == 254)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         a = 0;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     for (i = 0; i &lt; FILTER8_N; i++)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         filter_buf[i] = filter_buf[i + 1]; // 数组元素左移，将第0个元素舍弃</span></span><br><span class="line"><span class="comment">//         filter_sum += filter_buf[i] * coe[i];</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     filter_sum /= sum_coe;</span></span><br><span class="line"><span class="comment">//     printf(&quot;%d\n&quot;, filter_sum);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************************************</span></span><br><span class="line"><span class="comment">方法九： 消抖滤波法</span></span><br><span class="line"><span class="comment">方法：  设置一个滤波计数器，将每次采样值与当前有效值比较：</span></span><br><span class="line"><span class="comment">       如果采样值 = 当前有效值，则计数器清零；</span></span><br><span class="line"><span class="comment">       如果采样值 &lt; 或 &gt; 当前有效值，则计数器+1，并判断计数器是否 &gt;= 上限N（溢出）；</span></span><br><span class="line"><span class="comment">       如果计数器溢出，则将本次值替换当前有效值，并清计数器。</span></span><br><span class="line"><span class="comment">优点：  对于变化缓慢的被测参数有较好的滤波效果；</span></span><br><span class="line"><span class="comment">        可避免在临界值附近控制器的反复开/关跳动或显示器上数值抖动。</span></span><br><span class="line"><span class="comment">缺点：  对于快速变化的参数不宜；</span></span><br><span class="line"><span class="comment">       如果在计数器溢出的那一次采样到的值恰好是干扰值,则会将干扰值当作有效值导入系统。</span></span><br><span class="line"><span class="comment">******************************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define FILTER9_N 51</span></span><br><span class="line"><span class="comment">// unsigned short i = 0;</span></span><br><span class="line"><span class="comment">// unsigned short Value;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// short filter9()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     int new_value;</span></span><br><span class="line"><span class="comment">//     Value     = ftable[b - 1];</span></span><br><span class="line"><span class="comment">//     new_value = ftable[b];</span></span><br><span class="line"><span class="comment">//     b++;</span></span><br><span class="line"><span class="comment">//     if (b == 255)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         b = 1;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     if (Value != new_value)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         i++;</span></span><br><span class="line"><span class="comment">//         if (i &gt; FILTER9_N)</span></span><br><span class="line"><span class="comment">//         &#123;</span></span><br><span class="line"><span class="comment">//             i     = 0;</span></span><br><span class="line"><span class="comment">//             Value = new_value;</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     else</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         i = 0;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     printf(&quot;%d\n&quot;, Value);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************************************</span></span><br><span class="line"><span class="comment">方法十：限幅消抖滤波法</span></span><br><span class="line"><span class="comment">方法： 相当于“限幅滤波法”+“消抖滤波法”；</span></span><br><span class="line"><span class="comment">       先限幅，后消抖。</span></span><br><span class="line"><span class="comment">优点：  继承了“限幅”和“消抖”的优点；</span></span><br><span class="line"><span class="comment">        改进了“消抖滤波法”中的某些缺陷，避免将干扰值导入系统。</span></span><br><span class="line"><span class="comment">缺点：   对于快速变化的参数不宜。</span></span><br><span class="line"><span class="comment">******************************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define FILTER10_A 51</span></span><br><span class="line"><span class="comment">// #define FILTER10_N 5</span></span><br><span class="line"><span class="comment">// unsigned short i = 0;</span></span><br><span class="line"><span class="comment">// unsigned short Value;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// short filter10()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     unsigned short NewValue;</span></span><br><span class="line"><span class="comment">//     unsigned short new_value;</span></span><br><span class="line"><span class="comment">//     Value    = ftable[b - 1];</span></span><br><span class="line"><span class="comment">//     NewValue = ftable[b];</span></span><br><span class="line"><span class="comment">//     b++;</span></span><br><span class="line"><span class="comment">//     if (b == 255)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         b = 1;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     if (((NewValue - Value) &gt; FILTER10_A) || ((Value - NewValue) &gt; FILTER10_A))</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         new_value = Value;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     else</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         new_value = NewValue;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     if (Value != new_value)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         i++;</span></span><br><span class="line"><span class="comment">//         if (i &gt; FILTER10_N)</span></span><br><span class="line"><span class="comment">//         &#123;</span></span><br><span class="line"><span class="comment">//             i     = 0;</span></span><br><span class="line"><span class="comment">//             Value = new_value;</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     else</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         i = 0;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     printf(&quot;%d\n&quot;, Value);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief     主函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// filter1();</span></span><br><span class="line">        <span class="comment">// filter2();</span></span><br><span class="line">        <span class="comment">// filter3();</span></span><br><span class="line">        <span class="comment">// filter4();</span></span><br><span class="line">        <span class="comment">// filter5();</span></span><br><span class="line">        <span class="comment">// filter6();</span></span><br><span class="line">        <span class="comment">// filter7();</span></span><br><span class="line">        <span class="comment">// filter8();</span></span><br><span class="line">        <span class="comment">// filter9();</span></span><br><span class="line">        <span class="comment">// filter10();</span></span><br><span class="line">        Sleep(<span class="number">300</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="程序顺序执行、定时器任务执行及各种RTOS的优缺点及原理"><a href="#程序顺序执行、定时器任务执行及各种RTOS的优缺点及原理" class="headerlink" title="程序顺序执行、定时器任务执行及各种RTOS的优缺点及原理"></a>程序顺序执行、定时器任务执行及各种RTOS的优缺点及原理</h2><h3 id="程序顺序执行优缺点"><a href="#程序顺序执行优缺点" class="headerlink" title="程序顺序执行优缺点"></a>程序顺序执行优缺点</h3><p><strong>顺序执行：</strong>是指程序按照代码的书写顺序依次执行，每个任务必须等待前面的任务执行完成后才能执行。这种执行方式简单明了，<strong>易于理解和调试</strong>，但<strong>执行效率相对较低</strong>，因为程序需要等待前面的任务完成后才能开始执行下一个任务。</p><p><strong>并发执行：</strong>是指程序中的多个任务可以同时执行，不必等待前面的任务完成。这种执行方式可以<strong>提高执行效率</strong>，<strong>充分利用计算机的资源</strong>，但也<strong>会带来一些问题，如竞争条件、死锁等</strong>。</p><p><strong>程序顺序执行的特征主要包括顺序性、封闭性、可再现性、可控制性、自上而下、确定性：</strong></p><p><strong>顺序性：</strong>程序按照编写的顺序一步一步地执行，每一步完成后才能进入下一步，直到程序执行完毕。这一特征确保了程序执行的顺序性，即程序的操作严格按照程序所规定的顺序执行，每个操作必须在下一操作开始之前结束。</p><p><strong>封闭性：</strong>程序在封闭的环境下执行，即程序运行时独占全机资源，资源的状态（除初始状态外）只有本程序才能改变它。程序一旦开始执行，其执行结果不受外界因素影响。</p><p><strong>可再现性：</strong>程序的顺序执行是可重复的，即每次执行都按照相同的顺序和方式执行，结果也应该是相同的。只要程序执行时的环境和初始条件相同，当程序重复执行时，无论它是从头到尾不停顿地执行，还是“停停走走”地执行，都将获得相同的结果。</p><p><strong>可控制性：</strong>程序的顺序执行是可控制的，即可以通过程序中的控制语句（如条件语句、循环语句）来改变程序的执行顺序和方式。</p><p><strong>自上而下：</strong>程序的顺序执行是自上而下的，即从程序的第一行开始执行，直到最后一行结束。</p><p><strong>确定性：</strong>程序执行的结果与它的执行过程无关。换言之，就是程序无论是从头到尾地执行，还是“停停走走”地执行，都不会影响所得结果。</p><h3 id="定时器任务执行的优缺点"><a href="#定时器任务执行的优缺点" class="headerlink" title="定时器任务执行的优缺点"></a>定时器任务执行的优缺点</h3><p>定时器的工作原理是基于时序控制的模块，它的作用是按照程序预定的时序点，定时触发动作，从而起到程序控制的作用，它可以按照一定的时序，定时触发某些事件</p><p><strong>优点：</strong></p><ol><li>可以增加程序的灵活性</li><li>可以降低程序的复杂度（可以用它来控制单片机的某些动作，这样可以减少程序中的指令数）</li><li>可以提高程序的稳定性（它可以按照一定的时序触发某些事件，从而提高程序的可靠性）</li></ol><p><strong>缺点</strong>：</p><ol><li>容易出现程序错误（它可以按照一定的时序触发某些事件，但是这种触发事件可能会出现误差，从而导致程序错误）</li><li>会降低单片机的运行效率（按照一定的时序编程会占用一定的单片机处理时间，从而降低单片机的运行效率）</li></ol><p><strong>主要用途：</strong></p><ol><li><p>延时调节：可以用来对某种设备进行延时调节，控制某种设备的工作时间，从而达到控制设备的效果</p></li><li><p>定时控制：可以用来定时控制多种设备，按照一定的时序控制设备，从而获得更加精确的控制效果</p></li><li><p>事件触发：可以触发某种事件，按照一定的时序触发某种事件，从而达到控制程序的作用</p></li><li><p>系统调度：可以用来调度系统的操作，按照一定的时序来进行系统的调度控制，从而达到最佳的操作效果</p></li></ol><h3 id="RTOS的优缺点"><a href="#RTOS的优缺点" class="headerlink" title="RTOS的优缺点"></a>RTOS的优缺点</h3><p><strong>RTOS</strong>，全称 Real-Time Operating System ，即 <strong>实时操作系统</strong>。它是一种专门用于实时系统的操作系统，主要目的是提供及时响应和高可靠性。RTOS的核心在于其任务调度功能，它能严格按照优先级分配CPU时间片，确保实时任务得到及时处理。</p><p><strong>RTOS技术的概念及特点：</strong></p><ol><li>实时性：RTOS的最主要特征是对实时性的支持。它能够确保系统在规定的时间内对事件作出响应，包括硬实时系统（需要对任务响应时间进行硬性保证）和软实时系统（对任务的响应时间有一定的容忍度）。</li><li>任务调度：RTOS包含一个任务调度器，能够有效地管理多个任务的执行。它负责按照优先级或其他调度算法，决定哪个任务在何时执行。</li><li>任务管理：RTOS提供任务管理功能，允许开发者创建、删除、挂起和恢复任务。任务是系统中的基本执行单元，可以看作是一个独立的线程。</li><li>中断服务例程： RTOS通常支持中断服务例程，以处理来自外部设备或其他任务的中断请求。中断服务例程是一段能够在中断事件发生时迅速执行的代码。</li><li>实时时钟：RTOS提供实时时钟服务，用于测量和记录时间，帮助任务和事件的时间同步。</li><li>同步和通信机制：为了实现任务之间的合作和通信，RTOS提供了同步和通信机制，如信号量、消息队列、互斥锁等。</li><li>资源管理：RTOS能够有效地管理和分配系统资源，包括内存、外设等，以确保任务能够按照预期的方式协同工作。</li><li>可裁剪性：RTOS通常具有可裁剪的特性，允许用户根据具体应用的需求选择性地启用或禁用某些功能，以减小系统的开销。</li></ol><p><strong>优点：</strong></p><ol><li>系统结构更清晰：当代码量较大时，RTOS会提供一个稳定的、结构清晰的框架，方便后续的开发与维护。</li><li>模块化和高内聚：使用RTOS写任务可以做到更加模块化，高内聚，低耦合，有利于代码的学习和技术提升。</li><li>中间件丰富：RTOS中间件比较多，可以方便移植使用，减少开发者的工作量。</li><li>趋势和适应性：随着32位CPU市场的扩大，RTOS的使用也成为一个趋势，尤其在一些特定的行业如工控、医疗、航空军工等，RTOS的强实时性和高稳定性使其更具优势。</li></ol><p><strong>缺点：</strong></p><ol><li>资源开销：RTOS本身会占用一些系统资源，包括内存和处理器时间。</li><li>学习曲线：学习RTOS可能需要一些时间，特别是对于初学者。</li><li>不适用于所有应用：对于一些简单的嵌入式应用，引入RTOS可能会显得过于庞大和不必要。</li></ol><p><strong>RTOS与裸机如何选择：</strong></p><ol><li>实时性需求： 如果系统对实时性能要求较高，特别是在响应时间上有硬性要求，RTOS可能更为适用。</li><li>开发周期：对于较为简单的项目，裸机开发可能更快速。</li><li>复杂性：如果项目较为复杂，多任务、同步和通信需求较多，RTOS可能提供更好的抽象和管理。</li><li>资源约束：如果系统资源有限，裸机开发可能更为合适，因为RTOS本身会占用一些额外的资源。</li></ol><h2 id="IIC"><a href="#IIC" class="headerlink" title="IIC"></a>IIC</h2><h3 id="模拟iic和硬件iic区别"><a href="#模拟iic和硬件iic区别" class="headerlink" title="模拟iic和硬件iic区别"></a>模拟iic和硬件iic区别</h3><p><strong>I2C协议可以被模拟和硬件实现：</strong><br>模拟I2C是用两条GPIO（General Purpose Input Output）管脚的软件模拟的，将一个GPIO设置为数据线SDA，另外一个设置为时钟线SCL。<br>硬件I2C则是通过一个I2C控制器实现的，该控制器被建立在微控制器芯片或单独的I2C芯片中，通过集成的硬件内部逻辑和电路来控制时序和数据格式，实现I2C总线通信。</p><p>I2C协议传输时分为两类线，一类为时钟线SCL，另一类为数据线SDA。时钟线由主节点产生，用于同步数据传输，数据线用于传输真正的数据。</p><p>模拟I2C的主要限制是不能在高速模式下运行，并且有可能出现线路噪音、误码等问题。<br>硬件I2C通信更加可靠，并且具有更高的性能。</p><p>硬件控制器内置在微控制器芯片或者单独的I2C芯片中，在控制器的支持下，可以实现高速数据传输，避免了SCL和SDA之间的相互影响。此外，在硬件I2C中，处理信号和协议的复杂算法已经内置在控制器中，不需要用户自己实现，简化了通信过程，提高了可靠性。</p><p>软件I2C作为一个模拟方法，还存在另一个重要的缺点就是不同于硬件I2C，模拟I2C的芯片在同时进行通信时需要耗费大量的CPU资源，对内存和处理器速度的要求更高。<br>反过来，硬件I2C通常可以在任何操作系统和平台上轻松使用，这种通信协议不需要使用大量的额外的内存或处理器周期。</p><h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 函    数：I2C写SCL引脚电平</span></span><br><span class="line"><span class="comment"> * 参    数：BitValue 协议层传入的当前需要写入SCL的电平，范围0~1</span></span><br><span class="line"><span class="comment"> * 返 回 值：无</span></span><br><span class="line"><span class="comment"> * 注意事项：此函数需要用户实现内容，当BitValue为0时，需要置SCL为低电平，当BitValue为1时，需要置SCL为高电平</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">MyI2C_W_SCL</span><span class="params">(<span class="type">uint8_t</span> BitValue)</span></span><br><span class="line">&#123;</span><br><span class="line">    GPIO_WriteBit(GPIOB, GPIO_Pin_10, (BitAction)BitValue); <span class="comment">// 根据BitValue，设置SCL引脚的电平</span></span><br><span class="line">    Delay_us(<span class="number">10</span>);                                           <span class="comment">// 延时10us，防止时序频率超过要求</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 函    数：I2C写SDA引脚电平</span></span><br><span class="line"><span class="comment"> * 参    数：BitValue 协议层传入的当前需要写入SDA的电平，范围0~0xFF</span></span><br><span class="line"><span class="comment"> * 返 回 值：无</span></span><br><span class="line"><span class="comment"> * 注意事项：此函数需要用户实现内容，当BitValue为0时，需要置SDA为低电平，当BitValue非0时，需要置SDA为高电平</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">MyI2C_W_SDA</span><span class="params">(<span class="type">uint8_t</span> BitValue)</span></span><br><span class="line">&#123;</span><br><span class="line">    GPIO_WriteBit(GPIOB, GPIO_Pin_11, (BitAction)BitValue); <span class="comment">// 根据BitValue，设置SDA引脚的电平，BitValue要实现非0即1的特性</span></span><br><span class="line">    Delay_us(<span class="number">10</span>);                                           <span class="comment">// 延时10us，防止时序频率超过要求</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 函    数：I2C读SDA引脚电平</span></span><br><span class="line"><span class="comment"> * 参    数：无</span></span><br><span class="line"><span class="comment"> * 返 回 值：协议层需要得到的当前SDA的电平，范围0~1</span></span><br><span class="line"><span class="comment"> * 注意事项：此函数需要用户实现内容，当前SDA为低电平时，返回0，当前SDA为高电平时，返回1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">MyI2C_R_SDA</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint8_t</span> BitValue;</span><br><span class="line">    BitValue = GPIO_ReadInputDataBit(GPIOB, GPIO_Pin_11); <span class="comment">// 读取SDA电平</span></span><br><span class="line">    Delay_us(<span class="number">10</span>);                                         <span class="comment">// 延时10us，防止时序频率超过要求</span></span><br><span class="line">    <span class="keyword">return</span> BitValue;                                      <span class="comment">// 返回SDA电平</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 函    数：I2C初始化</span></span><br><span class="line"><span class="comment"> * 参    数：无</span></span><br><span class="line"><span class="comment"> * 返 回 值：无</span></span><br><span class="line"><span class="comment"> * 注意事项：此函数需要用户实现内容，实现SCL和SDA引脚的初始化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">MyI2C_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*开启时钟*/</span></span><br><span class="line">    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE); <span class="comment">// 开启GPIOB的时钟</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*GPIO初始化*/</span></span><br><span class="line">    GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_OD;</span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_10 | GPIO_Pin_11;</span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">    GPIO_Init(GPIOB, &amp;GPIO_InitStructure); <span class="comment">// 将PB10和PB11引脚初始化为开漏输出</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*设置默认电平*/</span></span><br><span class="line">    GPIO_SetBits(GPIOB, GPIO_Pin_10 | GPIO_Pin_11); <span class="comment">// 设置PB10和PB11引脚初始化后默认为高电平（释放总线状态）</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*协议层*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 函    数：I2C起始</span></span><br><span class="line"><span class="comment"> * 参    数：无</span></span><br><span class="line"><span class="comment"> * 返 回 值：无</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">MyI2C_Start</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    MyI2C_W_SDA(<span class="number">1</span>); <span class="comment">// 释放SDA，确保SDA为高电平</span></span><br><span class="line">    MyI2C_W_SCL(<span class="number">1</span>); <span class="comment">// 释放SCL，确保SCL为高电平</span></span><br><span class="line">    MyI2C_W_SDA(<span class="number">0</span>); <span class="comment">// 在SCL高电平期间，拉低SDA，产生起始信号</span></span><br><span class="line">    MyI2C_W_SCL(<span class="number">0</span>); <span class="comment">// 起始后把SCL也拉低，即为了占用总线，也为了方便总线时序的拼接</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 函    数：I2C终止</span></span><br><span class="line"><span class="comment"> * 参    数：无</span></span><br><span class="line"><span class="comment"> * 返 回 值：无</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">MyI2C_Stop</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    MyI2C_W_SDA(<span class="number">0</span>); <span class="comment">// 拉低SDA，确保SDA为低电平</span></span><br><span class="line">    MyI2C_W_SCL(<span class="number">1</span>); <span class="comment">// 释放SCL，使SCL呈现高电平</span></span><br><span class="line">    MyI2C_W_SDA(<span class="number">1</span>); <span class="comment">// 在SCL高电平期间，释放SDA，产生终止信号</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 函    数：I2C发送一个字节</span></span><br><span class="line"><span class="comment"> * 参    数：Byte 要发送的一个字节数据，范围：0x00~0xFF</span></span><br><span class="line"><span class="comment"> * 返 回 值：无</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">MyI2C_SendByte</span><span class="params">(<span class="type">uint8_t</span> Byte)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint8_t</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) <span class="comment">// 循环8次，主机依次发送数据的每一位</span></span><br><span class="line">    &#123;</span><br><span class="line">        MyI2C_W_SDA(Byte &amp; (<span class="number">0x80</span> &gt;&gt; i)); <span class="comment">// 使用掩码的方式取出Byte的指定一位数据并写入到SDA线</span></span><br><span class="line">        MyI2C_W_SCL(<span class="number">1</span>);                  <span class="comment">// 释放SCL，从机在SCL高电平期间读取SDA</span></span><br><span class="line">        MyI2C_W_SCL(<span class="number">0</span>);                  <span class="comment">// 拉低SCL，主机开始发送下一位数据</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 函    数：I2C接收一个字节</span></span><br><span class="line"><span class="comment"> * 参    数：无</span></span><br><span class="line"><span class="comment"> * 返 回 值：接收到的一个字节数据，范围：0x00~0xFF</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">MyI2C_ReceiveByte</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint8_t</span> i, Byte = <span class="number">0x00</span>; <span class="comment">// 定义接收的数据，并赋初值0x00，此处必须赋初值0x00，后面会用到</span></span><br><span class="line">    MyI2C_W_SDA(<span class="number">1</span>);         <span class="comment">// 接收前，主机先确保释放SDA，避免干扰从机的数据发送</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) <span class="comment">// 循环8次，主机依次接收数据的每一位</span></span><br><span class="line">    &#123;</span><br><span class="line">        MyI2C_W_SCL(<span class="number">1</span>); <span class="comment">// 释放SCL，主机在SCL高电平期间读取SDA</span></span><br><span class="line">        <span class="keyword">if</span> (MyI2C_R_SDA() == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Byte |= (<span class="number">0x80</span> &gt;&gt; i);</span><br><span class="line">        &#125; <span class="comment">// 读取SDA数据，并存储到Byte变量</span></span><br><span class="line">          <span class="comment">// 当SDA为1时，置变量指定位为1，当SDA为0时，不做处理，指定位为默认的初值0</span></span><br><span class="line">        MyI2C_W_SCL(<span class="number">0</span>); <span class="comment">// 拉低SCL，从机在SCL低电平期间写入SDA</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Byte; <span class="comment">// 返回接收到的一个字节数据</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 函    数：I2C发送应答位</span></span><br><span class="line"><span class="comment"> * 参    数：Byte 要发送的应答位，范围：0~1，0表示应答，1表示非应答</span></span><br><span class="line"><span class="comment"> * 返 回 值：无</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">MyI2C_SendAck</span><span class="params">(<span class="type">uint8_t</span> AckBit)</span></span><br><span class="line">&#123;</span><br><span class="line">    MyI2C_W_SDA(AckBit); <span class="comment">// 主机把应答位数据放到SDA线</span></span><br><span class="line">    MyI2C_W_SCL(<span class="number">1</span>);      <span class="comment">// 释放SCL，从机在SCL高电平期间，读取应答位</span></span><br><span class="line">    MyI2C_W_SCL(<span class="number">0</span>);      <span class="comment">// 拉低SCL，开始下一个时序模块</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 函    数：I2C接收应答位</span></span><br><span class="line"><span class="comment"> * 参    数：无</span></span><br><span class="line"><span class="comment"> * 返 回 值：接收到的应答位，范围：0~1，0表示应答，1表示非应答</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">MyI2C_ReceiveAck</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint8_t</span> AckBit;         <span class="comment">// 定义应答位变量</span></span><br><span class="line">    MyI2C_W_SDA(<span class="number">1</span>);         <span class="comment">// 接收前，主机先确保释放SDA，避免干扰从机的数据发送</span></span><br><span class="line">    MyI2C_W_SCL(<span class="number">1</span>);         <span class="comment">// 释放SCL，主机机在SCL高电平期间读取SDA</span></span><br><span class="line">    AckBit = MyI2C_R_SDA(); <span class="comment">// 将应答位存储到变量里</span></span><br><span class="line">    MyI2C_W_SCL(<span class="number">0</span>);         <span class="comment">// 拉低SCL，开始下一个时序模块</span></span><br><span class="line">    <span class="keyword">return</span> AckBit;          <span class="comment">// 返回定义应答位变量</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><ol><li>根据传输的位来拉<code>SCL</code>与<code>SDA</code>线电平：若该位为1，则拉高<code>SCL</code>与<code>SDA</code>线电平，否则就拉低</li><li><code>SCL</code>与<code>SDA</code>需默认<strong>拉高</strong>，以<strong>释放总线状态</strong>，准备好传输数据</li><li>IIC起始信号：<code>SCL</code>高电平，<code>SDA</code>下降沿<strong>（注：起始后需把SCL也拉低，使主机占用总线准备发送数据）</strong>；IIC结束信号：<code>SCL</code>高电平，<code>SDA</code>上升沿；</li><li>主机发送：每次发送1位，循环8次即可发送一个字节；在发送数据时，应先拉高<code>SCL</code>（从机在<code>SCL</code>高电平期间读取<code>SDA</code>），再拉低<code>SCL</code>（主机开始发送下一位数据）</li><li>从机接收：在接收前，应先拉高<code>SDA</code>，避免主机抢占<code>SDA</code>，导致数据出错；为存储接收到的数据，需拉高<code>SCL</code>，使主机在<code>SCL</code>高电平期间读取<code>SDA</code>，每读取一位就存入提前申请好的变量中；读完后即可得到一个字节的数据。然后拉低<code>SCL</code>，使从机可写入<code>SDA</code>，这样即可实现从机发送。</li><li>应答信号：主机把应答位数据放到<code>SDA</code>线；然后先拉高<code>SCL</code>，以读取应答位；再拉低<code>SCL</code>，开始下一个时序模块；</li></ol><h2 id="有刷电机的驱动方式，转速调节；频率对转速和电流的影响"><a href="#有刷电机的驱动方式，转速调节；频率对转速和电流的影响" class="headerlink" title="有刷电机的驱动方式，转速调节；频率对转速和电流的影响"></a>有刷电机的驱动方式，转速调节；频率对转速和电流的影响</h2><h3 id="有刷电机转动原理"><a href="#有刷电机转动原理" class="headerlink" title="有刷电机转动原理"></a>有刷电机转动原理</h3><p><strong>组成：定子、转子、电刷、换向器</strong></p><p><strong>原理：</strong>外接电源给电机通电，电流经过电刷流向与换向器连接的线圈（转子），电流流过线圈产生磁场；产生的磁场与定子磁场互斥，则转子转动；</p><p>转子转动半圈后若无外力，由于转子磁场与定子磁场同性相吸，则趋于稳定，不再转动；但由于换向器的存在导致线圈中电流流向与之前相反（因为换向器位置与之前相反，而换向器与线圈相连，故线圈中电流流向与之前相反），故而又与此刻的定子磁场互斥，又使转子转动；</p><p>以上步骤不停循环就导致转子持续转动。</p><h3 id="有刷电机转速受哪些因素影响"><a href="#有刷电机转速受哪些因素影响" class="headerlink" title="有刷电机转速受哪些因素影响"></a>有刷电机转速受哪些因素影响</h3><p>电压、负载、磁通量等；其中，电压与电流是影响电机转速为重要的因素</p><h3 id="如何调节有刷电机转速"><a href="#如何调节有刷电机转速" class="headerlink" title="如何调节有刷电机转速"></a>如何调节有刷电机转速</h3><ol><li>调节电压，有刷电机的转速与电压成正比，因此可以通过调节电压来改变电机的转速。但是需要注意，过高或过低的电压都会对电机造成损害，因此需要根据电机的额定电压来调节电压。</li><li>调节电流，电机的转速还与其所受的负载有关，因此可以通过调节电流来改变电机的转速。增加电流可以提高电机的转速，但是需要注意电机的额定电流，避免电机过载。</li><li>更换齿轮更换不同大小的齿轮可以改变电机的输出转速。一般来说，大齿轮可以降低电机的转速，小齿轮则可以提高电机的转速。</li><li>调节磁通量调节磁通量也可以影响电机的转速。增加磁通量可以提高电机的转速，但是需要注意电机的磁通量和饱和磁通量，以避免电机工作不稳定或过载。</li></ol><h3 id="频率对转速和电流的影响"><a href="#频率对转速和电流的影响" class="headerlink" title="频率对转速和电流的影响"></a>频率对转速和电流的影响</h3><p>增加频率会增加转速</p><h2 id="二分法"><a href="#二分法" class="headerlink" title="二分法"></a>二分法</h2><h4 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> ADC_Table[<span class="number">101</span>] = &#123;</span><br><span class="line">    <span class="number">3999</span>,</span><br><span class="line">    <span class="number">3967</span>, <span class="number">3961</span>, <span class="number">3954</span>, <span class="number">3947</span>, <span class="number">3940</span>, <span class="number">3932</span>, <span class="number">3924</span>, <span class="number">3916</span>, <span class="number">3907</span>, <span class="number">3899</span>,</span><br><span class="line">    <span class="number">3889</span>, <span class="number">3880</span>, <span class="number">3870</span>, <span class="number">3860</span>, <span class="number">3850</span>, <span class="number">3839</span>, <span class="number">3827</span>, <span class="number">3816</span>, <span class="number">3804</span>, <span class="number">3791</span>,</span><br><span class="line">    <span class="number">3779</span>, <span class="number">3766</span>, <span class="number">3752</span>, <span class="number">3738</span>, <span class="number">3724</span>, <span class="number">3708</span>, <span class="number">3693</span>, <span class="number">3676</span>, <span class="number">3660</span>, <span class="number">3643</span>,</span><br><span class="line">    <span class="number">3625</span>, <span class="number">3607</span>, <span class="number">3589</span>, <span class="number">3570</span>, <span class="number">3550</span>, <span class="number">3530</span>, <span class="number">3510</span>, <span class="number">3489</span>, <span class="number">3468</span>, <span class="number">3446</span>,</span><br><span class="line">    <span class="number">3424</span>, <span class="number">3401</span>, <span class="number">3378</span>, <span class="number">3354</span>, <span class="number">3330</span>, <span class="number">3306</span>, <span class="number">3281</span>, <span class="number">3255</span>, <span class="number">3229</span>, <span class="number">3203</span>,</span><br><span class="line">    <span class="number">3175</span>, <span class="number">3146</span>, <span class="number">3117</span>, <span class="number">3088</span>, <span class="number">3058</span>, <span class="number">3028</span>, <span class="number">2997</span>, <span class="number">2966</span>, <span class="number">2935</span>, <span class="number">2903</span>,</span><br><span class="line">    <span class="number">2871</span>, <span class="number">2839</span>, <span class="number">2806</span>, <span class="number">2774</span>, <span class="number">2741</span>, <span class="number">2707</span>, <span class="number">2674</span>, <span class="number">2640</span>, <span class="number">2607</span>, <span class="number">2573</span>,</span><br><span class="line">    <span class="number">2539</span>, <span class="number">2505</span>, <span class="number">2471</span>, <span class="number">2436</span>, <span class="number">2402</span>, <span class="number">2368</span>, <span class="number">2334</span>, <span class="number">2300</span>, <span class="number">2265</span>, <span class="number">2231</span>,</span><br><span class="line">    <span class="number">2197</span>, <span class="number">2163</span>, <span class="number">2130</span>, <span class="number">2096</span>, <span class="number">2063</span>, <span class="number">2028</span>, <span class="number">1993</span>, <span class="number">1959</span>, <span class="number">1925</span>, <span class="number">1891</span>,</span><br><span class="line">    <span class="number">1857</span>, <span class="number">1823</span>, <span class="number">1790</span>, <span class="number">1758</span>, <span class="number">1725</span>, <span class="number">1693</span>, <span class="number">1661</span>, <span class="number">1630</span>, <span class="number">1599</span>, <span class="number">1580</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief       查询ADC对应温度</span></span><br><span class="line"><span class="comment"> * @param[1]    arr ADC数组</span></span><br><span class="line"><span class="comment"> * @param[2]    left right 数组的首末下标</span></span><br><span class="line"><span class="comment"> * @param[3]    x 实时获取的ADC值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">adc_search</span><span class="params">(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">short</span>* arr, <span class="type">unsigned</span> <span class="type">char</span> left, <span class="type">unsigned</span> <span class="type">char</span> right, <span class="type">unsigned</span> <span class="type">short</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= arr[<span class="number">0</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x &lt;= arr[<span class="number">100</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (arr[mid] &gt;= x &amp;&amp; arr[mid + <span class="number">1</span>] &lt;= x)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (arr[mid] &lt;= x)</span><br><span class="line">        &#123;</span><br><span class="line">            right = mid - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (arr[mid] &gt;= x)</span><br><span class="line">        &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">adc_search(ADC_Table, <span class="number">0</span>, <span class="number">100</span>, ntc_adc);</span><br></pre></td></tr></table></figure><h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><ol><li>二分法为什么会陷入死循环？</li></ol><p>判断条件选取的不对，多一个 <code>=</code> 就有可能陷入死循环；另外数组最好为<strong>单数</strong>，双数极可能陷入死循环</p><ol start="2"><li>为什么 <code>while (left &lt;= right)</code> 用 <code>&lt;=</code> 不用 <code>&lt;</code> ？</li></ol><p>因为 <code>right</code> 的值为 <code>数组元素个数 - 1</code> ，这时 <code>left</code> 与 <code>right</code> 是可以相等的</p><ol start="3"><li>为什么取中间数要写成 <code>int mid = left + (right - left) / 2;</code> 这样？</li></ol><p>因为若 <code>left + right</code> 很大的时候会发生整形溢出，这样写可以尽量避免</p><ol start="4"><li>为什么判断条件写成 <code>if (arr[mid] &gt;= x &amp;&amp; arr[mid + 1] &lt;= x)</code> 这样？</li></ol><p>因为数组元素为 <code>unsigned short</code> 型，不会出现浮点数，且数组元素不是等差为1的等差数列，不是非此即彼，可能会出现 <code>arr[mid] &gt;= x &amp;&amp; arr[mid + 1] &lt;= x</code> 这种情况</p><ol start="5"><li>建议：遇到死循环将 <code>left</code> <code>right</code> <code>mid</code> 打印出来看看</li></ol><h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><h4 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> QUEUE_SIZE 50</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="built_in">queue</span>[QUEUE_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">int</span> head = <span class="number">0</span>; <span class="comment">// 队头出</span></span><br><span class="line"><span class="type">int</span> tail = <span class="number">0</span>; <span class="comment">// 队尾进</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init_queue</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    head = <span class="number">0</span>;</span><br><span class="line">    tail = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 入队操作</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">enqueue</span><span class="params">(<span class="type">int</span> value)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ((tail + <span class="number">1</span>) % QUEUE_SIZE == head)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;QUEUE IS FULL!\n&quot;</span>); <span class="comment">// 队满</span></span><br><span class="line">        init_queue(); <span class="comment">// 队头、队尾清零；重新开始，即循环队列</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">queue</span>[tail] = value;</span><br><span class="line">    tail = (tail + <span class="number">1</span>) % QUEUE_SIZE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 出队操作</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">dequeue</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (head == tail)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;QUEUE IS EMPTY!\n&quot;</span>); <span class="comment">// 队空</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> result = <span class="built_in">queue</span>[head];</span><br><span class="line">    <span class="built_in">queue</span>[head] = <span class="number">0</span>;</span><br><span class="line">    head = (head + <span class="number">1</span>) % QUEUE_SIZE;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印队列</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">printQueue</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i = head;</span><br><span class="line">    <span class="keyword">while</span> (i != tail)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, <span class="built_in">queue</span>[i]);</span><br><span class="line">        i = (i + <span class="number">1</span>) % QUEUE_SIZE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        enqueue(i);</span><br><span class="line">    &#125;</span><br><span class="line">    printQueue(); <span class="comment">// QUEUE IS FULL!</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">49</span>; i &lt; <span class="number">98</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        enqueue(i);</span><br><span class="line">    &#125;</span><br><span class="line">    printQueue(); <span class="comment">// 49 ~ 98</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h4><ol><li>队列（数组）的长度一般都要比要存入的数据长度大不少</li><li>使用该操作，队列（数组）的最后一个元素不会被使用，这就是第一点的原因</li></ol><h2 id="六轴陀螺仪工作原理，数据处理"><a href="#六轴陀螺仪工作原理，数据处理" class="headerlink" title="六轴陀螺仪工作原理，数据处理"></a>六轴陀螺仪工作原理，数据处理</h2><h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><blockquote><p>参考：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/propor/article/details/136938863">https://blog.csdn.net/propor/article/details/136938863</a></p></blockquote><h2 id="锂电池充放电原理"><a href="#锂电池充放电原理" class="headerlink" title="锂电池充放电原理"></a>锂电池充放电原理</h2><h3 id="锂电池充电有四个阶段"><a href="#锂电池充电有四个阶段" class="headerlink" title="锂电池充电有四个阶段"></a>锂电池充电有四个阶段</h3><p>涓流充电、恒流充电、恒压充电、充电结束</p><p>充电初期采用恒流充电，电池电压增加，当到达一定值后，再采用恒压充电，电流逐渐降低，直到到达设定值，完成充电过程。</p><h4 id="阶段1：涓流充电"><a href="#阶段1：涓流充电" class="headerlink" title="阶段1：涓流充电"></a>阶段1：涓流充电</h4><p>涓流充电用来先对<strong>完全放电</strong>的电池单元进行预充 — 恢复性充电。</p><p>在电池电压低于满电电压时，先采用最大xxc（一般为0.1C）的恒定电流对电池进行充电。</p><p>0.1C即 恒流充电电流的十分之一</p><h4 id="阶段2：恒流充电"><a href="#阶段2：恒流充电" class="headerlink" title="阶段2：恒流充电"></a>阶段2：恒流充电</h4><p>当电池电压上升到涓流充电阈值以上时，提高充电电流进行恒流充电。</p><p>恒流充电的电流一般在0.2C至 1.0C之间。恒流充电时的电流并不要求十分精确，准恒定电流也可以。</p><h4 id="阶段3：恒压充电"><a href="#阶段3：恒压充电" class="headerlink" title="阶段3：恒压充电"></a>阶段3：恒压充电</h4><p>当电池电压上升到满电电压时，恒流充电结束，开始恒压充电阶段。</p><h4 id="阶段4：充电终止"><a href="#阶段4：充电终止" class="headerlink" title="阶段4：充电终止"></a>阶段4：充电终止</h4><p>充电结束</p></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" rel="tag"># 嵌入式</a></div><div class="post-nav"><div class="post-nav-item"><a href="/archives/2bb50ac9.html" rel="prev" title="Ubuntu服务器部署FRP内网穿透"><i class="fa fa-chevron-left"></i> Ubuntu服务器部署FRP内网穿透</a></div><div class="post-nav-item"><a href="/archives/bbd81c5a.html" rel="next" title="嵌入式之红外通信">嵌入式之红外通信 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Totoro</span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>